var J1616_www_appVersions = {famous:"1.0.1",music:"1.0.0",clock:"1.0.0",my1616:"1.0.0",jmail:"1.0.0",weather:"1.0.0",search:"1.0.1",stock:"1.0.1",memo:"1.0.0",layout:"1.0.0",news:"1.0.0",xingzuo:"1.0.0",note:"1.0.0",caipiao:"1.0.0"};/*具有跨域接口的swf文件id*/
var swfId = J1616.Const.getConst("crossDomainSwfId");

/*实现跨域请求*/
function JAJAX(timeout){
	 this.id = ++arguments.callee.id || (arguments.callee.id = 0);
	 this.timeout = timeout;
};

JAJAX.prototype = {
	type : 'GET',
	data : null,
	open: function(url, id, data) {
		if(data){
			this.type = 'POST';
			this.data = data;
			this.swfInterface = window[swfId]||document[swfId];
			/*兼容opera及chrome*/
			this.swfInterface = this.swfInterface["1"] || this.swfInterface;
			//if(!window['RUN_JAJAX_CALLBACK']) window['RUN_JAJAX_CALLBACK'] = function(){eval(arguments[0])}
		}else{
			(this.s = document.createElement("script")).setAttribute("type", "text/javascript");
			this.s.src = url + (url.indexOf("?") == -1 ? "?" : "&") + "callback=" + "JAJAX_CALLBACK_" + id + "&__=" + new Date().getTime();
		}
		this.url = url;
		return this;
	},
	send : function(fn){
		var _this = this, IE = "\v" == "v";
		var _timer = setTimeout(function(){
			fn('{code:999}');
			clear();
		}, this.timeout);
		var call = this.type == 'GET' ? 'JAJAX_CALLBACK_' + this.id : 'RUN_JAJAX_CALLBACK';
		window[call] = function(e){
			clearTimeout(_timer, fn(e), clear());
		};
		if(this.type == 'GET'){
			var h = document.getElementsByTagName('head')[0];
			h.insertBefore(this.s, h.firstChild);
			/*document.getElementsByTagName('head')[0].appendChild(this.s);*/
		}else{
			_this.swfInterface.JS_asRequest(_this.url, _this.data);
		}
		function clear(){
			try{
				if(_this.type == 'GET'){
					_this.s.parentNode.removeChild(_this.s);
				}else{
					_this.swfInterface.JS_abort();
				}
			}finally{
				_timer = null;
				IE ? window[call] = null : delete window[call];
			}
		}
	}
};

/**
* 读写
*/
J1616.IO = {
    U: J1616.Util,
    prefix: "J1616_www_",
    /*
    存储: http://my.1616.net/update.php
    请求: http://my.1616.net/get.php
    */
    req: "http://my" + J1616.Util.getDomain() + "/get.php",
    upd: "http://my" + J1616.Util.getDomain() + "/update.php",

    /* 基于cookie的存储, 参数个数为1的时候为取值器 */
    cdata: function(k, v) {
        var T = this;
		return typeof v == "undefined" ? T.U.getCookie(k) : T.U.setCookie(k, v, null, null);
    },

    /*请求config, 目前只实现了get方法
    * @param {number} 1 表示取服务器, 0 表示本地
    * @param {string} appname
    * @param {function}  回调函数,第一个参数即为取回来的JSON，形如{famous:"配置串",...,clock:"配置串"}
    */
    request: function(pos, app, fn) {
        if (pos) {
            this.XHR(this.req + "?name=" + app, fn)
        } else {
            var apps = app.split(",");
            var s = "";
            for (var i = 0, p; p = apps[i]; i++) {
                //s += p + ":" + decodeURIComponent(this.cdata(this.prefix + p)) + ",";
                //取自本地的时候，不用decodeURIComponent了，因为J1616.Util.getCookie已经处理过。--马凯
                s += this.cdata(this.prefix + p) + "|@|";
            }
            s = s.replace(/\|@\|$/, "");
            fn(s);
        }
    },


    /**
    * 存储config, 目前只实现了get方法
    * @param {number} 1 表示取服务器, 0 表示本地
    * @param {object} kv 最终会转换为cookie key->val 及 get 请求 key->val
    * @param {function}  回调函数,第一个参数即为返回的字符串
	* @param {bool} post 表示是否用post方法, ***注意*** post是同步的。阻塞式。而get是异步的  切记!!!
    * ex : 
    *       save(0,{my1616:config, famous:config},fn) 存本地
    *       save(1,{my1616:config, famous:config},fn) 存db
    */

    save: function(pos, key, val, fn, post) {
        if (!pos) {
            this.cdata(this.prefix + key, val);
            fn('{code:1}')
        } else {
            if(post){
				var data = {};
				data[key] = encodeURIComponent(val);
				this.XHR(this.upd, fn, data)
			}else
				this.XHR(this.upd + "?" + key + "=" + encodeURIComponent(val), fn)
        }
    },
    /* -> 此实现在FF下按F5有代码不可控制的 IFRAME缓存问题, 废除.
    XHR: function(sUrl, fnCallBack) {
    fnCallBack = fnCallBack || new Function();
    sUrl += (sUrl.indexOf('?') > 0 ? '&' : '?') + 'WINDOWNAME=true';
    var frame = document.createElement('iframe'), state = 0;
    document.body.appendChild(frame).style.display = 'none';
    frame.readyState ? frame.attachEvent("onload", done) : frame.onload = done;
    frame.src = sUrl;
    function getData() {
    try {
    fnCallBack(frame.contentWindow.name);
    frame.contentWindow.document.write('');
    frame.contentWindow.close();
    document.body.removeChild(frame);
    } catch (e) {
    fnCallBack('{code:999}')
    }
    }
    function done() { state == 1 ? getData() : (state = 1, frame.contentWindow.location = "about:blank") }
    }
    */
    XHR: function(url, fn, data, timeout) {
        var req = new JAJAX(timeout || 10000);
		req.open(url, req.id, data).send(fn);
    }
};


/**
* 需要:library.js、J1616.IO.js支持
*/
J1616.www = {
    /**	
    * Namespace简写
    */
    U: J1616.Util,
    I: J1616.IO,
    /**
    * 获取当前用户信息
    * @property {bool} i 是否登录
    * @property {string} n 用户名
    */
    ac: { i: false, n: "游客" },
    _ac: function() {
        var re = this.ac;
        if (top && top.J1616.www && top.J1616.www.ac)
            re = top.J1616.www.ac;
        return re;
    },
    /**
    * 本机测试
    */
    root: "http://r.61658.com/", /*J1616.Const.getConst("root"),*/
    pdm: "http://passport" + J1616.Util.getDomain(), /*passport产品的domain*/
    mdm: "http://my" + J1616.Util.getDomain(), /*my产品的domain*/
    cns: ["search", "famous", "music", "clock", "jmail", "weather", "stock","caipiao"], /*要广播的App+要一次性读取配置的App*/
    cfgs: {}, /*缓存所有App的cfg，形如{"famous":cfg,"music":cfg}*/
    /**
    * 读/写用户的应用配置。参数v为没有的时候为读配置。异步的。
    * 注意：存的时候v不用J1616.obj2str()串行化。取的时候需要J1616.str2obj()还原一下
    * @method config
    * @param {string} k App的names,多个apps形如"app1,app2,app3"。必填
    * @param {string} v 应用的配置。string类型。可选
    * @param {function} fn 成功后的回调函数，必填。
    *                            读：带一个处理结果的参数{JSON String} returnInfo 举例{code:0,desc:"失败"}
    *                            写：带一个处理结果的参数{JSON String} returnInfo 举例{code:1,desc:"成功"}
    * @public
    */
    config: function(k, v, fn) {
        var ar = arguments;
        if (ar.length == 2 && typeof ar[1] == "function") {
            /*this.I.request(this._ac().i, ar[0], ar[1]);*/
        } else if (ar.length == 3 && typeof ar[2] == "function") {
            /*判断v的长度,超过定数，自己转为post存储*/
            /*this.I.save(this._ac().i, ar[0], ar[1], ar[2], encodeURIComponent(v).length >= 1350);*/
        }
    }
};

/// <reference path="../../../include/i/js/jquery-vsdoc.js" /> 
/**
* 要调用swf接口必须加上这么一句, IE则不需要, 
* 时钟部份，特殊, 并不需要初始化 swf注册接口之后会自动调用J1616.www.clock.init
*/
document.all || document.addEventListener("DOMContentLoaded", function () { window.swfInterfaceIsReady = true }, false);


var cur_bc = 0, gs_d = { i: -1, kw: '', u: '', gkw: '' }, fs_d = [];

/***********一些首页函数，属于历史遗留,暂保留*****************/
function has(i, e) { var pn = e; while (pn) { if (pn.id == i) return true; pn = pn.parentNode } return false }

function euc(s) { return encodeURIComponent(s) }
/* dcs stands for Document.Createelement for Script, i.e, create a <script> element in the document */
function dcs(s, i) { $("#" + i).remove(); var js = document.body.appendChild(document.createElement("SCRIPT")); js.src = s; if (i) js.id = i }
/* s16 stands for statistics for 1616 */
function s16(a, p) {
	var wp = ["act=" + a];
	for (var i = 0; i < p.length; i += 2)
		wp.push(p[i] + "=" + euc(p[i + 1]));
	$('<img />').attr('src', "http://st.1616.net/s.php?" + wp.join("&"));
}
/**
* sh means show / hide 
* @param {string/html object} o
* @param {bool} i 是否显示
* @pararm {string} 强制指定"block","inline-block"
*/
function sh(o, i, s) {
	if (typeof (o) == "string") o = $("#" + o);
	$(o).css("display", i ? (s ? s : "block") : "none");
}

/*兼容ie9的swf获取方式*/
function getSWF(id) {
	var swf = window[id] || document[id];
	return navigator.userAgent.indexOf('MSIE 9.0') !== -1 ? swf[0] : (swf['1'] || swf);
}

/*阻止冒泡的兼容函数*/
function stopBubble(e) {
	if (e.stopPropagation) e.stopPropagation();
	else e.cancelBubble = true;
}
/************************************************************/

/**
* 输出右上角的日历
*/
function outputDate(t) {
	$("#date_panel").html(date(t));
	/*<a href=# class=clockin><em class= ></em>[闹钟提醒]</a><a href=#>2009年12月4日</a><a href=#>十月十八 周五</a>*/
	/*只执行一次, 请求并输出服务器时间*/
	outputDate.done || $.getScript('http://w.1616.net/chaxun/clock.php?call=outputDate');
	function date(a) {
		var d = a ? new Date(1000 * a) : new Date();
		outputDate.done = a;
		var ymd = d.getFullYear() + "年" + (d.getMonth() + 1) + "月" + d.getDate() + "日&nbsp;&nbsp;", week = ['日', '一', '二', '三', '四', '五', '六'];
		var xz = J1616.Util.getCookie('XZ') || "0";
		return ('<a href="http://wannianli.7999.com">'
		+ ymd
		+ lunar(d)[1] + lunar(d)[2]
		+ " 周"
		+ week[d.getDay()]
		+ '</a>');
	}
}


/*先输出本机时间，稍后再取服务器时间*/
outputDate();

/*计算农历 返回值:2009,腊月,十二,(true/false),己丑,戊寅,丙子*/
function lunar(t) {
	var lunarI = [0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2, 0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977, 0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970, 0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950, 0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557, 0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5d0, 0x14573, 0x052d0, 0x0a9a8, 0x0e950, 0x06aa0, 0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0, 0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b5a0, 0x195a6, 0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570, 0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0, 0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5, 0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930, 0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530, 0x05aa0, 0x076a3, 0x096d0, 0x04bd7, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45, 0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0];
	var Gan = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
	var Zhi = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
	var mons = ["正", "二", "三", "四", "五", "六", "七", "八", "九", "十", "冬", "腊"];

	function cycal(num) {
		return (Gan[num % 10] + Zhi[num % 12]);
	}
	function _lYDays(y) {
		var i, sum = 348;
		for (i = 0x8000; i > 0x8; i >>= 1) { sum += (lunarI[y - 1900] & i) ? 1 : 0; }
		return (sum + _lDays(y));
	}
	function _lDays(y) {
		if (_lMonth(y)) { return ((lunarI[y - 1900] & 0x10000) ? 30 : 29); }
		else { return (0); }
	}
	function _lMonth(y) {
		return (lunarI[y - 1900] & 0xf);
	}
	function monthDays(y, m) {
		return ((lunarI[y - 1900] & (0x10000 >> m)) ? 30 : 29);
	}
	function Lunar(t) {
		var i, leap = 0, temp = 0;
		var baseDate = new Date(1900, 0, 31);
		var offset = Math.floor((t.getTime() + 2206425600000) / 86400000);
		this.dayCyl = offset + 40;
		this.monCyl = 14;
		for (i = 1900; i < 2050 && offset > 0; i++) {
			temp = _lYDays(i);
			offset -= temp;
			monCyl += 12;
		}
		if (offset < 0) {
			offset += temp;
			i--;
			monCyl -= 12;
		}
		year = i;
		yearCyl = i - 1864;
		leap = _lMonth(i);
		isLeap = false;
		for (i = 1; i < 13 && offset > 0; i++) {
			if (leap > 0 && i == (leap + 1) && isLeap == false)
			{ --i; isLeap = true; temp = _lDays(year); }
			else
			{ temp = monthDays(year, i); }

			if (isLeap == true && i == (leap + 1)) isLeap = false;

			offset -= temp;
			if (isLeap == false) monCyl++;
		}
		if (offset == 0 && leap > 0 && i == leap + 1) {
			if (isLeap) {
				isLeap = false;
			}
			else {
				isLeap = true; --i; --monCyl;
			}
		}
		if (offset < 0) { offset += temp; --i; --monCyl; }

		month = i;
		day = offset + 1;
		var tday = (day < 11) ? "初" : ((day < 20) ? "十" : ((day < 30) ? "廿" : "卅"));
		if (day % 10 != 0 || day == 10) tday += "一二三四五六七八九十".charAt((day - 1) % 10);
		return [year, mons[month - 1] + "月", tday, isLeap, cycal(yearCyl), cycal(monCyl), cycal(dayCyl)];
	}
	return Lunar(t);
}

function set_home(o) {
	s16(1, ["pn", "名站导航", "u", "#", "t", "设为首页"]);
	o.target = "_self";
	if (document.all && !external.max_version) {
		o.style.behavior = 'url(#default#homepage)';
		o.setHomePage(location.href);
	} else window.open("http://www.1616.net/jd/sethome.html");
}

function chk_mail(o) { return J1616.www.jmail.chk(o); }

function shortcut() { J1616.www.jmail.change(); }

function pn(s) {
	var r = has('best-r', s) ? "名站导航" : has('manylinks', s) || has('multi-s', s) ? s.parentNode.parentNode.getElementsByTagName('a')[0].innerHTML.replace(' ', '').replace('：', '') : '';
	if (r == "")
		r = has('chaxun', s) ? '实用查询' :
				(
					has('ada', s) ? 'ad' : ''
				);
	return r;
}

function add_fav() {
	var a = window.sidebar, b = location.href, c = "7999上网导航";
	if (document.all) {
		external.addFavorite(b, c)
	}
	else if (a) {
		a.addPanel(c, b, "")
	}
}

/**
* Tab切换
*/
function set_bc(bc) {
	if (bc == cur_bc) return;
	$('#bc' + cur_bc).attr('class', "");
	$('#bc' + bc).attr('class', "on");
	sh('fs', bc == 0);
	if (bc == 0) {
		sh('_bc0Btn', 0);
		sh('bc0Btn', 1, "inline");
	} else {
		J1616.www.famous._cancel();
		sh('_bc0Btn', 1, "inline");
		sh('bc0Btn', 0);
	}
	sh('bests', bc == 0);
	sh('other', bc > 0);

	var bcs = ["app/bests", "app/stock", "app/caipiao-s"];
	if (bc != 3) {
		$('#ifother').attr("src", bcs[bc] + '.htm');
		$('#ifother').attr('class', '');
		$('#ifmusic').removeClass('musicy');
	} else {
		if ($('#ifmusic').attr("src") == "about:blank") $('#ifmusic').attr("src", bcs[3] + '.htm');
		$('#ifother').attr("src", "about:blank");
		$('#ifother').attr("class", 'hide');
		$('#ifmusic').addClass('musicy');
	}
	cur_bc = bc;
}

function wwwfirst_cb(d) {
	fs_d = d;
	var k = d[0] ? d[0].split("|")[0] : ""; //$.trim($('#keyword').val());	
	if (!k) return;
	dcs('http://www.google.cn/complete/search?hl=zh-CN&q=' + euc(k) + '&_=' + Math.random(), 'gsg');
	setTimeout(function () {
		if ($('#kwh tr').length < 1 || k != gs_d.gkw) google.ac.h([k, []]);
	},
    150
    );
}

function smc(d) {
	var k = $.trim($('#keyword').val()), h = '', _s = " onmouseover='this.style.backgroundColor=\"#88C4FF\";gs_d.u=\"\"' onmouseout='this.style.backgroundColor=\"#ECF5FF\"' onclick='shmd(this)'";
	if (!k || k != d[0].split('|')[0]) return;
	for (var i = 1; i < d.length; i++) {
		h += '<tr' + _s + '><td _h="' + d[i][4].replace(/\"/g, '') + ' ' + d[i][7].replace(/\"/g, '') + '"><a><span>' + d[i][7] + '</span> ' + d[i][4] + '</a></td></tr>';
	}
	$('#kwh').html('<table onmousedown="stopBubble(event)" width="100%" cellpadding=0 cellspacing=1>' + h + '</table>');
	sh('kwh', h.length > 0);
}

function hint(e, t) {
	var kwd = $('#keyword'), ek = e.keyCode;
	if (!kwd.val().length || ek == 10 || ek == 13 || ek == 27) {
		sh('kwh', 0);
		gs_d.u = "";
		return;
	}

	if (ek == 38 || ek == 40) {
		if ($('#kwh').css('display') == 'none') { sh('kwh', 1); return }

		var trs = $('#kwh table tr');
		if (ek == 38) gs_d.i = (gs_d.i == -1) ? trs.length - 1 : gs_d.i - 1;
		else gs_d.i = (gs_d.i + 1) % trs.length;

		trs.each(function (i) {
			if (i == gs_d.i) {
				$(this).css('backgroundColor', '#88c4ff');
				var cel = $(this.cells[0]);
				kwd.val(cel.attr('_h'));
				gs_d.u = cel.attr('_u') ? cel.attr('_h') : "";
			}
			else $(this).css('backgroundColor', '#ECF5FF');
		});

		if (gs_d.i == -1) {
			gs_d.u = "";
			kwd.val(gs_d.kw);
		}
	}
	else {
		gs_d.i = -1;
		gs_d.kw = kwd.val();
		/*如果是搜索音乐*/
		if (t == 1) {
			dcs('http://suggest.mp3cn.net/song/?call=smc&type=songname&q=' + euc($.trim(kwd.val())), 'fsg');
		} else {
			dcs('http://so.1616.net/wwwfirst/?q=' + euc($.trim(kwd.val())), 'fsg');
		}
	}
}

function shmd(o) {
	var td = $(o.firstChild);
	if (td.attr('_u')) gs_d.u = td.attr('_h');
	else $('#keyword').val(td.attr('_h'));
	J1616.www.search.do_s();
}

var google = {
	ac:
	{
		h: function (a) {
			if (!a.length || a.length < 2 || a[0] != $.trim($('#keyword').val())) return;
			gs_d.gkw = a[0];
			var ih = '', _shmh = " onmouseover='this.style.backgroundColor=\"#88C4FF\";gs_d.u=\"\"' onmouseout='this.style.backgroundColor=\"#ECF5FF\"' onclick='shmd(this)'";
			if (fs_d.length == 2 && $.trim(fs_d[0].split('|')[0]) == a[0] && J1616.www.search.num == 0) {
				var f1 = fs_d[1], tt = f1[3];
				if (f1[0] > -1)
					tt = f1[3].substr(0, f1[0]) + "<span class=kw-hi>" + f1[3].substr(f1[0], f1[1] - f1[0] + 1) + "</span>" + f1[3].substr(f1[1] + 1);
				ih = "<tr style='cursor:hand'" + _shmh + "><td align=left _u=1 _h='" + f1[4] + "'><p>" + tt + "</p><p style='color:#888;font-size:12px;overflow:hidden;text-overflow:ellipsis;height:14px;white-space:nowrap;width:358px'>" + f1[5] + "</p><p style='color:#090;font-size:12px'>" + f1[4] + "</p></td></tr>";
			}
			var b = a[1];
			if (b.length)
				for (var j = 0; j < b.length; j++) {
					if (J1616.getType(b[j]) == "array" && b[j].length == 3) {
						if (b[j][0].indexOf("hao123.") < 0 && b[j][0] != 'hao123' && b[j][0].indexOf("好123") < 0)
							ih += '<tr' + _shmh + '><td _h="' + b[j][0].replace(/\"/g, '') + '"><a><span>' + b[j][1] + '</span> ' + b[j][0] + '</a></td></tr>';
					}
				}
			$('#kwh').html('<table onmousedown="stopBubble(event)" width="100%" cellpadding=0 cellspacing=1>' + ih + '</table>');
			sh('kwh', ih.length > 0);
		}
	}
};


function check_clock() {
	var al = J1616.Util.getCookie('alert'), next_alert = null;
	if (al) {
		var alf = al.split('$'), d = new Date(), today = [d.getFullYear(), d.getMonth(), d.getDay()].join("-"), now = d.getHours() * 60 + d.getMinutes();
		for (var i = 0; i < alf.length; i++) {
			var alt = alf[i].split("|"), hm = alt[0].split(':'), _n = parseInt(hm[0]) * 60 + parseInt(hm[1]), bgs = $('<bgsound />').attr('src', './mid/' + alt[1] + '.mid');
			if (alt[3] == 'undone') {
				alt[3] = alt[4] = "";
			}
			if (_n <= now && alt[4] != today) {
				al = '';
				for (var j = 0; j < alf.length; j++)
					if (i == j) {
						if (alt[3] != '') {
							alt[4] = today;
							al += (al.length ? "$" : "") + alt.join("|");
						}
					}
					else al += (al.length ? "$" : "") + alf[j];

				if (al.length) J1616.Util.setCookie('alert', al);
				else J1616.Util.setCookie('alert', '', -1);

				$('body').append(bgs);
				hm[0] = hm[0].length == 1 ? "0" + hm[0] : hm[0];
				hm[1] = hm[1].length == 1 ? "0" + hm[1] : hm[1];
				alert((_n != now ? "过期闹钟" : "闹钟提醒") + "：“" + hm[0] + ":" + hm[1] + " " + ((alt[2].length) ? alt[2] : "您设置的闹钟时间已到!") + "”");
				bgs.remove();
				break;
			}
		}
		var near = 9999, alf = al.split('$');
		for (var i = 0; i < alf.length; i++) {
			var hm = alf[i].split("|")[0].split(":");
			var t = parseInt(hm[0]) * 60 + parseInt(hm[1]);
			if (t <= now) t += 1440;
			if (t < near) {
				near = t;
				next_alert = hm.join(":");
			}
		}
	}
	$('#clockhint').attr("class", next_alert ? "on" : "");
	if (next_alert) $('#clockhint').attr("title", '您的下次闹钟提醒时间：' + next_alert);
	setTimeout(check_clock, 1000);
}

/**
* Platform
* 需要:library.js、J1616.IO.js、J1616.www.js支持
*/
J1616.www.index = {
	/**	
	* Namespace简写
	*/
	W: J1616.www,
	U: J1616.Util,
	C: J1616.Const.getConst,
	S: J1616.Theme,
	I: J1616.IO,
	i: 1, /*是否 通过输入网址或刷新打开的首页,默认是*/
	_apps: [], /*需要重新导入cfg的app，用数组存起来，以便一次性导入*/
	/**
	* 导入App.两种情形：
	* 1.注册成功的时候导
	* 2.还有一种情形：之前未保存到数据库，后来又可以保存到数据库了。
	* 本质上是已登录用户的APP版本号不一致，才导入
	* @method importCfgs
	* @param {json} json { code: 1, desc: username }
	* @param {array} apps 形如["famous","clock"]
	* @param {function} fn 函数
	* @public
	*/
	importCfgs: function (json, apps, fn) {
		var T = this, done = 0, all = apps.length;
		if (json.code == 1) {
			T.W.ac = { i: true, n: json.desc };

			for (var i = 0; i < all; i++) {
				T.W.config(apps[i], T.W.cfgs[apps[i]], function () {
					done++;
					if (fn && typeof (fn) == "function" && done == all) fn();
				});
			}
		}
	},
	p_callback: function (json) {
		var o = $("#passport"), /* h = "",*/T = this;
		switch (json.code) {
			case 1:
				h = "<a class=jwiUname href=#>" + json.desc + "</a>，欢迎您！进入<a class=jwiUname href=#>我的账户</a>或<a id=jwiLogout href=#>退出登录</a>";
				T.W.ac = { i: true, n: json.desc };
				break;
			case 0:
				h = "亲爱的网友，<a id=jwiLogin href=#>请先登录</a>或<a id=jwiReg href=#>免费注册</a>以永久保存您的设置";
				T.W.ac = { i: false, n: "游客" };
				break;
		}
		h += "！";
		o.html(h);
		T._jwiEvts();

		/*获取所有APP的配置,然后进行一系列操作*/
		T.W.config(T.W.cns.join(","), function (cfgs) {
			/**
			* 当且仅当J1616.www.cfgs被赋值后，才能保证其他App的NS正常运转
			*/
			if (!cfgs) return;
			cfgs = cfgs.split("|@|");
			for (var i in T.W.cns) T.W.cfgs[T.W.cns[i]] = cfgs[i];
			if (cfgs) {
				/*“cfgs最好是取的时候都有值”*/
				for (var k in cfgs) {
					try {
						if ((!cfgs[k]) || cfgs[k] === "null")
							T.W.cfgs[T.W.cns[k]] = J1616.obj2str(J1616.www[T.W.cns[k]].__cfg);
					} catch (e) {
					}
				}
			}

			T.i = 0;

			/**
			* 第一时间就升级App的配置
			*/
			(function () {
				for (var k in T.W.cns) {
					var _b = T.W.cns[k], _a = J1616.www[_b];
					var vers = J1616.str2obj(T.U.getCookie(T.C("cookies")[1]));
					var v1 = J1616_www_appVersions[_b],
                            v0 = vers && vers[_b] ? vers[_b] : null;
					if (v0 != v1) {
						if (typeof (_a["__upgrade"]) == "function") {
							_a["__upgrade"](function () { fireEvents(_a, _b) }, function () { updateVersion(_b, v1) });
						} else {
							fireEvents(_a, _b);
							updateVersion(_b, v1);
						}
						T._apps[T._apps.length] = T.W.cns[k];
					} else {
						fireEvents(_a, _b)
					}

				}
				/**
				* 触发某个APP的__login/__logout/__setTheme事件
				*/
				function fireEvents(_a, _b) {
					try {
						if (T.W.ac.i && typeof (_a["__login"]) == "function") {/*登录后的响应*/
							_a["__login"]()
						} else if (typeof (_a["__logout"]) == "function") {/*注销后的响应*/
							_a["__logout"]()
						}
					} catch (e) {
					}
					/**
					* App换肤                    
					try {
					if (!(_b == "clock" && T.i))//闹钟初次打开（用户输入网址）不用广播__setTheme()--flash自己调用
					if (typeof (_a["__setTheme"]) == "function") _a["__setTheme"]();
					} catch (e2) {
					}*/
				}
				/**
				* 升级完后，更新客户端指定APP的版本号
				*/
				function updateVersion(_b, v) {
					J1616_www_appVersions[_b] = v;
					T.U.setCookie(T.C("cookies")[1], J1616.obj2str(J1616_www_appVersions));
				}
			})();

			/*导入配置*/
			/*T.importCfgs(T.W.ac.i,T._apps);*/

		});
	},
	/**
	* 注册
	*/
	p_reg: function () {
		var T = J1616.www.index;
		T.U.showWindow({
			infoType: "normal",
			title: "注册",
			height: 320,
			width: 440,
			iframe: "passport/i_register.htm",
			theme: "blue", /*J1616.Theme.dialog*/
			onhide: function () { $('.keyword').focus() }
		});
		return false
	},
	/**
	* 登录
	*/
	p_login: function () {
		var T = J1616.www.index, setting = typeof arguments[0] == 'string' ? arguments[0] : '';
		T.U.showWindow({
			infoType: "normal",
			title: "登录",
			height: 320,
			width: 440,
			iframe: "passport/i_login.htm?" + setting,
			theme: "blue"/*J1616.Theme.dialog*/,
			onhide: function () { $('.keyword').focus() }
		});
		return false
	},
	/**
	* 个人信息页
	*/
	p_account: function () {
		var T = J1616.www.index;
		T.U.showWindow({
			infoType: "normal",
			title: "我的账户",
			height: 240,
			width: 440,
			iframe: "passport/i_account.htm",
			theme: "blue"/*J1616.Theme.dialog*/
		});
		return false
	},
	/**
	* 注销.
	*/
	p_logout: function () {
		var T = J1616.www.index;
		T.U.setCookie("Usecure", "", null, null, T.U.getDomain());
		/*更新ac*/
		T.W.ac = { i: false, n: "游客" };
		T.p_callback({ code: 0, desc: "" });
		return false
	},
	/**
	* 判断用户是否登录，JSONP形式
	* @param {string} callback 回调函数的名字，比如"J1616.www.isLogin_callback({code:1,desc:""})"
	* @method
	*/
	isLogin: function (callbackName) {
		$.getScript(this.W.pdm + "/checkLogin.php?ns=" + callbackName);
	},
	/**
	* 点出统计 
	*/
	stat: function (ev) {
		ev = ev || window.event;
		sh('kwh', 0);
		var s = ev.srcElement || ev.target;
		try {
			if (s.tagName == "IMG") s = s.parentNode;
			if (s.tagName == "A") {
				if (has('leftBigDiv', s)) {
					s16(1, ["pn", pn_leftBigDiv(s), "u", s.href, "t", $(s).text().replace(/ /g, '')]);
					return true;
				}
				var h = "http://" + location.host;
				if (s.href == "#" || s.href == h + "/#") s.target = "_self";
				if (s.href.match(/^\s?http:\/\//i) && s.href.indexOf(h) < 0)
					s16(1, ["pn", pn(s), "u", s.href, "t", $(s).text().replace(/ /g, '')]);
			}
		} catch (e) { }
		return true;
	},
	_jwiEvts: function () {
		var T = this;
		$("#passport .jwiUname").live("click", T.p_account);
		$("#jwiLogout").live("click", T.p_logout);
		$("#jwiReg").live("click", T.p_reg);
		$("#jwiLogin").live("click", T.p_login);
	},
	/*手机充值判断*/
	_mobChk: function () {
		var a = $('#chzmobile'), b = $('#chztype'), c = "手机号码";
		if (a.val() == '' || a.val() == c || a.val().length != 11 || !a.val().match(/^1[3|4|5|8][0-9]\d{4,8}$/)) {
			alert("请正确输入你的手机号码!");
			a.focus();
			return false
		}
		if (b.val() == '') {
			alert("请选择你要充值的面额!");
			b.focus();
			return false
		}
		$('#chzform').submit();
	},
	_mobEvts: function () {
		var T = this;
		$('#chzmobile').keypress(function (e) {
			if (e.keyCode == 13) return T._mobChk();
		}).focus(function () {
			if ($(this).val() == '手机号码') $(this).val('');
		});
		$("#chzbtn").click(function () {
			return T._mobChk();
		});
	},
	_events: function () {
		var T = this;
		document.body.onmousedown = function (event) { T.stat(event) };
		T._jwiEvts();
		T._mobEvts();
	},
	init: function () {
		var T = this;
		//二级内页、其他二级产品的皮肤默认为蓝色
		T.U.setCookie("style", "blue", null, null, T.U.getDomain());

		/*IE6存在样式中背景图片不缓存的BUG http://playgoogle.com/?p=49 */
		try { document.execCommand("BackgroundImageCache", false, true) } catch (e) { }

		check_clock();

		$.getScript('http://w.1616.net/chaxun/iptolocal.php?type=7999', function () {
			T.W.weather.render(WData);
			T.W.famous.render(WData);
		});

		/*google统计 延迟2.5秒加载(如果来源是404.htm，那么不加载Google统计)*/
		if (location.href.indexOf("404") == -1) {
			setTimeout(function () {
				T.U._import({
					src: "http://www.google-analytics.com/ga.js",
					version: ""
				}, function () {
					_gat._getTracker("UA-52896-11")._trackPageview();
				});
			}, 2500);
		}

		T.isLogin("J1616.www.index.p_callback");
		T._events();
	}
};
function pn_leftBigDiv(s) {
	do {
		s = s.parentNode;
	} while (s && s.tagName != 'DIV');
	var a = s.parentNode.getElementsByTagName('div');
	for (var i = 0; i < a.length; i++)
		if (a[i] == s) break;
	return '休闲娱乐 生活资讯 电脑网络 地方服务 文化教育'.split(' ')[i];
}
/**
* 名站导航。依赖J1616.www
*/
J1616.www.famous = {
	W: J1616.www,
	c: $([]), /*cache容器（container），提速==>div.best-zd*/
	l: null, /*cache List ==> li*/
	lk: null, /*cache List ==> li>a:eq(0)*/
	la: $([]), /*cache List ==> li>a:eq(1)*/
	f: 0, /*是否首次点击“定制”*/
	s: 0, /*是否打开提示框*/
	__version: "1.0.0",
	__so: 1, /*0或1，表示此app的传输数据量比较大, 会利用flash 跨域post大量数据*/
	__cfg: [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], /*用户配置*/
	_cfg: [], /*原始配置,还原用*/
	curItem: {},
	_events: function () {
		var T = this;
		/*第一次点击后，触发一系列动作*/
		$("#bc0Btn").click(function () {
			/*首次点击*/
			if (!T.f) {
				T.c = $("div.best-zd");
				T.l = $("#bc0List>li");
				T._crBtn();
				T.lk = $("#bc0List>li>a:even");
			}
			T.s = 1;
			T._showLoginInfo();

			T.la.css('display', '');
			T.f = 1;

			sh("bc0Btn", 0);
			sh("bc0Btn_", 1, "inline");
		});

		$("#bc0Btn_").click(function () {
			T._cancel();
		});
	},
	_showLoginInfo: function () {
		var h = "<div class='best-sc-setin'>", T = this, json = T.W.ac, s = $("#best-zdbottom");

		if (json.i) {
			h += "<p>您已登录，可定义24个网址！点击下面网址后的编辑链接开始定制。"
		}
		else {
			h += "<p>您还未登录，仅可自定义最后一行的6个网址，如定义更多网址<a href=# onclick=\"return J1616.www.index.p_login()\">请先登录</a>或<a href=# onclick=\"return J1616.www.index.p_reg()\">免费注册</a>。"
		}
		h += "</p><p><em class=wenhao></em><a href=http://bbs.1616.net/thread-6375-1-1.html>图文帮助</a></p></div>";
		if (T.c.length) {
			T.c.html(h);
			T.s ? T.c.show() : T.c.hide();
			T.s ? s.show() : s.hide();
		}
	},
	/**
	* creat 编辑按钮
	*/
	_crBtn: function () {
		var T = this;
		for (var i = 0; i < T.l.length; i++)
			$(T.l[i]).append($("<A />").attr("i", i).html("[编辑]"));
		T.la = $("a[i]");
		T._bdEvts();
	},
	/*给"编辑"链接加上事件*/
	_bdEvts: function () {
		var T = this;
		T.la.unbind('click').click(T._edit);
		T.la.each(function (i) {
			var l = $(this);
			if (!T.W.ac.i && i < 18) l.attr("class", "mybests-n");
			else l.attr("class", "mybests-e").attr("href", "#"); /*为了链接变色*/
			/*T.la[i].setAttribute("class", "best-sc-edit-n");---不能这样写，否则IE下不会给A套上class样式*/
		});
	},
	/**
	* 实现供外部调用的，名字已经约定好，未登录时的响应函数
	*/
	__logout: function () {
		var T = this;
		T._html();
		T._bdEvts();
		T._showLoginInfo();
	},
	/**
	* 实现供外部调用的，名字已经约定好，登陆时的响应函数
	*/
	__login: function () {
		this.__logout()
	},
	/**
	* show 编辑框
	*/
	_edit: function (e) {
		e = e || window.event;
		var T = J1616.www.famous, o = e.srcElement || e.target, i = o.getAttribute("i"), c = J1616.str2obj(T.W.cfgs["famous"]);
		var h1 = "您未登录，仅可对最后一行网址进行编辑。请先登录：", to = "http://www" + T.W.U.getDomain() + "/app/famous_edit.htm", title = "自定义网址", height = "220";
		T.curItem = { id: i, data: (c[i].length ? c[i] : [T.lk[i].innerHTML, T.lk[i].href]) };
		if (o.className == "mybests-e") {
			T.W.U.showWindow({
				infoType: "normal",
				title: "自定义网址",
				height: 220,
				width: 440,
				iframe: "app/famous_edit.htm",
				theme: "blue"/*J1616.Theme.dialog*/
			});
		} else {
			T.W.U.showWindow({
				infoType: "normal",
				title: "登录",
				height: 320,
				width: 440,
				/*
				登陆页支持四个参数
				http://passport.1616dh.com/i_login.htm?h1=自定义提示文字&to=登陆成功后的跳转地址&title=跳转后弹窗的标题&height=高度(整数)
				前三个参数都需要encodeURIComponent编码。
				*/
				iframe: "passport/i_login.htm?h1=" + euc(h1) + "&to=" + euc(to) + "&title=" + euc(title) + "&height=" + height,
				theme: "blue"/*J1616.Theme.dialog*/
			});
		}
		return false
	},
	_cancel: function () {
		var T = this;
		T.s = 0;
		T.c.hide();
		$("#best-zdbottom").hide();
		T.la.hide();
		sh("bc0Btn", 1, "inline");
		sh("bc0Btn_", 0);
	},
	/**
	* 根据__cfg生成并置入最终的html
	*/
	_html: function () {
		var T = this, c = J1616.str2obj(T.W.cfgs["famous"]), l = T.lk;
		if (c && c.length) {
			/*因为1616dh上是42个，且配置通用，所以这里需要砍掉18个*/
			if (c.length > 24) {
				for (var i = 0; i < 18; i++) {
					c.shift();
				}
				T.W.cfgs["famous"] = J1616.obj2str(c)
			}
			for (var i = 0; i < c.length; i++) {
				if (c[i].length) {
					l[i].innerHTML = c[i][0];
					//如过用户未输入http://，给他加上http://前缀
					var _b = /^(http|https|ftp):\/\/{1}/i.test(c[i][1]) ? c[i][1] : "http:\/\/" + c[i][1];
					l[i].href = ' ' + _b; //IE bug： http://topic.csdn.net/u/20090807/11/e15a9916-b6c4-4197-ba6c-570572b8c360.html
				} else {/*如果配置里面没有数据，则复原*/
					l[i].innerHTML = T._cfg[i][0];
					l[i].href = ' ' + T._cfg[i][1];
				}
			}
		}
	},
	/**
	* 地方网址。根据城市显示网址
	*/
	render: function (WData) {
		var d = new Date();
		$.get('/c/' + WData[4] + '.js?_=' + d.getFullYear() + d.getMonth() + d.getDate(), function (r) {//前端每天新发出一个请求地址
			eval(r);

			var o = J1616_www_famous, h = [], s = "";
			for (var i in o) {
				if (o[i][2] > 1) {
					s = " style='color:" + (o[i][2] === "1" ? "green" : "red") + "'";
				}
				h[i] = "<li><a href='" + o[i][1] + "'" + s + ">" + o[i][0] + "</a></li>";
			}
			$("#bests>ul:eq(2)").html(h.join(''));
		});
	},
	/*仅执行一次*/
	init: function () {
		var T = this;
		T.lk = $("#bc0List a"); /*这个表达式返回的结果居然是引用型，T.lk会根据后来bc0List中a的变化来变化*/
		/*构造默认配置*/
		for (var i = 0; i < T.lk.length; i++) {
			T.__cfg[i] = []; //["",""];
			T._cfg[i] = [T.lk[i].innerHTML, T.lk[i].href];
		}
		T._events();
	}
};


/**
* 邮箱登陆 相关判断
*/
J1616.www.jmail = {
	W: J1616.www,
	U: J1616.Util,
	__cfg: [],
	change: function () {
		var a = $('#mailselect').val();
		if (a == "qq") {
			window.open("http://mail.qq.com");
		} else if (a == "hotmail") {
			window.open("http://login.live.com/");
		} else if (a == "sogou") {
			window.open("http://mail.sogou.com/");
		} else if (a == "139") {
			window.open("http://mail.139.com/");
		} else if (a == "gmail") {
			window.open("http://mail.google.com/");
		} else if (a == "188") {
			window.open("http://www.188.com/");
		}
	},
	chk: function (o) {
		var a = o.mailuser, b = o.mailselect, c = o.mailpwd, T = this;
		if (a.value == "") {
			alert("请输入用户名！");
			a.focus();
			return false
		}
		if (b.value == "") {
			alert("请选择邮箱！");
			b.focus();
			return false
		}
		if (c.value == "") {
			alert("请输入密码！");
			c.focus();
			return false
		}
		switch (b.value) {
			case "163":
				o.action = "http://reg.163.com/login.jsp?style=1&type=1&url=http://entry.mail.163.com/coremail/fcg/ntesdoor2?style=1&lightweight%3D1%26verifycookie%3D1%26";
				o.username.value = a.value;
				o.password.value = c.value;
				break;
			case "126":
				o.action = "https://reg.163.com/logins.jsp";
				o.domain.value = "126.com";
				o.username.value = a.value + "@126.com";
				o.password.value = c.value;
				o.url.value = "http://entry.mail.126.com/cgi/ntesdoor?lightweight%3D1%26verifycookie%3D1%26language%3D0%26style%3D-1";
				break;
			case "yeah":
				o.action = "https://reg.163.com/logins.jsp";
				o.domain.value = "yeah.net";
				o.username.value = a.value + "@yeah.net";
				o.password.value = c.value;
				o.url.value = "http://entry.mail.yeah.net/cgi/ntesdoor?lightweight%3D1%26verifycookie%3D1%26style%3D-1";
				break;
			/*case "188":
			o.action = "http://reg.mail.188.com/servlet/coremail/login?language=0&style=1";
			o.user.value = a.value;
			o.pass.value = c.value;
			break;*/ 
			case "sohu":
				o.action = "http://passport.sohu.com/login.jsp";
				o.url.value = "";
				o.UserName.value = a.value;
				o.Password.value = c.value;
				o.id.value = a.value;
				o.username.value = a.value;
				o.password.value = c.value;
				o.m.value = a.value;
				o.passwd.value = c.value;
				o.mpass.value = c.value;
				o.loginid.value = a.value + "@sohu.com";
				o.fl.value = "1";
				o.vr.value = "1|1";
				o.appid.value = "1000";
				o.ru.value = "http://login.mail.sohu.com/servlet/LoginServlet";
				o.eru.value = "http://login.mail.sohu.com/login.jsp";
				o.ct.value = "1173080990";
				o.sg.value = "5082635c77272088ae7241ccdf7cf062";
				break;
			case "yahoo":
				o.action = "https://edit.bjs.yahoo.com/config/login";
				o.login.value = a.value;
				o.passwd.value = c.value;
				break;
			case "yahoocn":
				o.action = "https://edit.bjs.yahoo.com/config/login";
				o.login.value = a.value + "@yahoo.cn";
				o.passwd.value = c.value;
				break;
			case "tom":
				o.action = "http://bjweb.163.net/cgi/163/login_pro.cgi";
				o.user.value = a.value;
				o.pass.value = c.value;
				break;
			case "21cn":
				o.action = "http://passport.21cn.com/maillogin.jsp";
				o.LoginName.value = a.value;
				o.passwd.value = c.value;
				o.domainname.value = "21cn.com";
				o.UserName.value = a.value + "@21cn.com";
				break;
			case "sina":
				o.action = "http://mail.sina.com.cn/cgi-bin/login.cgi";
				o.u.value = a.value;
				o.psw.value = c.value;
				break;
			/*case "gmail":
			o.action = "https://www.google.com/accounts/ServiceLoginAuth";
			o.Email.value = a.value;
			o.Passwd.value = c.value;
			break;*/ 
			case "chinaren":
				o.action = "http://passport.sohu.com/login.jsp";
				o.loginid.value = a.value + "@chinaren.com";
				o.passwd.value = c.value;
				o.fl.value = "1";
				o.vr.value = "1|1";
				o.appid.value = "1005";
				o.ru.value = "http://profile.chinaren.com/urs/setcookie.jsp?burl=http://alumni.chinaren.com/";
				o.ct.value = "1174378209";
				o.sg.value = "84ff7b2e1d8f3dc46c6d17bb83fe72bd";
				break;
			case "tianya":
				o.action = "http://www.tianya.cn/user/loginsubmit.asp";
				o.vwriter.value = a.value;
				o.vpassword.value = c.value;
				break;
			case "baidu":
				o.action = "http://passport.baidu.com/?login";
				o.username.value = a.value;
				o.password.value = c.value;
				break;
			case "xiaonei":
				o.action = "http://login.xiaonei.com/Login.do";
				o.email.value = a.value;
				o.password.value = c.value;
				break;
			case "51com":
				o.action = "http://passport.51.com/login.5p";
				o.passport_51_user.value = a.value;
				o.passport_51_password.value = c.value;
				o.gourl.value = "http%3A%2F%2Fmy.51.com%2Fwebim%2Findex.php";
				break;
		}
		T.W.config("jmail", J1616.obj2str(a.value + "@" + b.value), function (o) {
			if (J1616.str2obj(o).code == 1) T.U.console("info", "存储Jmail成功")
		});
		c.value = "";
		return true
	},
	eventData: function () {
		var T = this;
		if (T.__cfg.length > 0) {
			$("#mailuser").val(T.__cfg[0]);
			$("#mailselect").val(T.__cfg[1]);
		}
	},
	__login: function () {
		var T = this, V = J1616.str2obj(T.W.cfgs['jmail']);
		if (V.indexOf("@") != -1) {
			T.__cfg = V.split("@");
			T.eventData();
		}
	},
	__logout: function () {
		var T = this;
		if (T.U.getCookie("J1616_www_jmail")) {
			T.__cfg = J1616.str2obj(T.U.getCookie("J1616_www_jmail")).split("@");
			T.eventData();
		}
	},
	init: function () { }
};

/**
* 天气预报 - 只实现换肤接口, 并不需要初始化
* iframe子页面需要实现window.setTheme()函数. 风格(string)作为参数传入此函数内部
*/

J1616.www.weather = {
	/**
	* @param {array} 由http://w.1616.net/chaxun/iptolocal.php?type=7999返回的数组
	*/
	render: function (WData) {
		$.getScript('http://weather.7999.com/grab/weather/' + encodeURIComponent(encodeURIComponent(WData[1])) + '.js', function () {
			var 描述 = J1616_weather_info.info.today['描述'], 气温 = J1616_weather_info.info.today['气温'];
			$('#data>span:last-child').html('<a href="http://weather.7999.com" title="查看7天详细预报">' + WData[1] + '： ' + 描述[0] + '，' + 气温 + /*'，' + 描述[1] +*/'</a>');
		});
	}
};

/**
* 音乐播放器 - 只实现换肤接口, 并不需要初始化
* iframe子页面需要实现window.__setTheme()函数. 风格(string)作为参数传入此函数内部
*/
J1616.www.music = {
	/*装载此插件的iframe id*/
	ifr: $("#ifmusic"),
	__cfg: null,
	load: function () {
		var T = this;
		T.ifr.attr("src", "app/_music.htm");
		T.ifr.load(T.__setTheme);
	},
	unload: function () { this.ifr.attr("src", "about:blank") },
	__login: function () {
		try {
			this.ifr[0].contentWindow['__login']()
		} catch (e) {
		}
	},
	__logout: function () {
		try {
			this.ifr[0].contentWindow['__logout']()
		} catch (e) {
		}
	}
};

/**
* App:搜索
*/
J1616.www.search = {
	/*
	* 点出统计对应的数字
	* '1' => '网页','2' => 'MP3','3' => '影视','4' => '视频','5' => '图片','6' => '贴吧','7' => '更多','8' => '淘宝','9' => '地图','10'=> '下载', '11'=> '百度', '14' => '谷歌', '15' => '搜搜','16' => 'Google'
	*/
	arr: {
		"网页": [['www.baidu.com/s?ie=utf-8&wd=[K]'/*搜索接口*/, 'www.baidu.com/'/*logo链接*/, "sp0"/*图标名，不带后缀*/, 14/*统计对应的数字*/]],
		"Google": [['sq.5258.net/c.php?q=[K]'/*搜索接口*/, 'sq.5258.net/c.php?q='/*logo链接*/, "spgg"/*图标名，不带后缀*/, 16/*统计对应的数字*/]],
		"MP3": [['music.baidu.com/search?from=new_mp3&key=[K]', 'music.baidu.com', "sp1", 2]],
		"图片": [['image.baidu.com/i?ie=utf-8&ct=201326592&cl=2&lm=-1&tn=baiduimage&word=[K]', 'image.baidu.com ', "sp2", 5]],
		"视频": [['video.baidu.com/v?ie=utf-8&word=[K]', 'video.baidu.com', "sp3", 4]],
		"下载": [['www.verycd.com/search/folders?kw=[K]', 'www.verycd.com', "sp4", 10]],
		"购物": [['www.summall.com/search?key=[K]&get=1&source=1616', 'www.summall.com',"sp10", 8]],
		"地图": [['map.sogou.com/?lq=[K]', 'map.sogou.com/index.html?ie=utf8&query=&pid=sogou-site-a37ebbec40176375', "sp6", 9]]
	},
	curTab: "网页", //默认Tab
	swf: null,
	/**
	* 构造特殊的搜索html
	*/
	renderSo: function (key) {
		var T = this, html = '';
		$("#searchbox").empty();
		var curTab = T.arr[key];

		for (var i = 0, l = curTab.length; i < l; i++) {
			html += '<div _i="' + i + '" class="searchItem">';
			html += '<div class="searchlogo"><a class="sp-img" ' + _(curTab[i][1]) + '><img src="http://r.61658.com/7999/img/' + curTab[i][2] + '.gif"></a></div>';
			html += '<div class="searchc">';
			html += '<input class="keyword" />';
			html += '<input type="button" class="s-btn" />';
			html += '</div>';
			html += '</div>';
		}

		function _(url) {
			var r = "";
			if (url) r = 'href="http://' + url+'"';
			/*改百度协议为https开始*/
			if (url.indexOf('www.baidu.com/s') !=-1)
			r = 'href="https://' + url+'"';
			/*改百度协议为https结束*/
			return r;
		}
		$("#searchbox").html(html);

		/******关键词******/
		var htm = [], swf = T.swf;
		/*c_kws[key].length == 0 || $.each(c_kws[key], function (j, v) {
			if(v && key == "网页"){
				var arrweb = v.split('&#');
				arrweb[0] == undefined || htm.push('<a href="'+arrweb[1]+'">' + arrweb[0] + '</a>');
			}else{
				//这里作一些处理，因为cms生成的数组后面多一个逗点,
				//v == undefined || htm.push('<a href="http://' + curTab[0][0].replace('[K]', (curTab[0][0].indexOf(".sogou.") != -1) ? euc(v) : swf.GB2312(v)) + '">' + v + '</a>');
				v == undefined || htm.push('<a href="http://' + curTab[0][0].replace('[K]', (curTab[0][0].indexOf(".sogou.") != -1) ? euc(v) : euc(v)) + '">' + v + '</a>');
			}
		});
		$('#kws').html(htm.join(''));*/
	},
	events: function () {
		var T = this;
		$('#s-tl>a').click(function () {
			var a = $('#s-tl>a'), i = a.index(this), key = $(this).text();
			a.removeClass('s-cur'); $(this).addClass('s-cur');
			T.curTab = key;
			T.renderSo(key);
			$('input.keyword:eq(0)').focus();
			return false;
		});
		$('input.s-btn').live("click", function () {
			T.do_s();
		});
		$('input.keyword').live("keypress", function (e) {
			if (e.keyCode == '13') T.do_s();
		})/*.live("keyup", function (e) {
			T.hint(e || window.event)
		})*/;
	},
	do_s: function () {
		var T = this, ua = navigator.userAgent.toLowerCase(), V = $("div.searchItem[_i=0]").find("input.keyword").val();
		var curSo = T.arr[T.curTab][0];
		$('#kwh').hide();

		s16(3, ["st", curSo[3], 'sn', T.curTab]);

		if (gs_d.u != '') {
			s16(5, ["u", gs_d.u]);
			submitAsForm(gs_d.u)
			gs_d.u = '';
		}
		else {
			s16(2, ["kw", V]);
			//如果是百度或者淘宝，则要转码为GB2312
			//var charset = !!curSo[0].match(/taobao|baidu|alimama/) ? 'GB2312' : 'UTF-8';
			charset = 'UTF-8';
			submitAsForm('http://' + curSo[0].replace('[K]', V), charset);
		}

		//提供一个URL，JS分析创建表单提交
		function submitAsForm(requestUri, charset) {
			var s = requestUri.split('?'), d = document, div = d.createElement('DIV');
			div.innerHTML =
				'<form method="GET" action="' + s[0] + '">' +
				s[1].replace(/\b((\w+)\=(.*?))(&|$)/gi, function (s, m, n, v) {
					return '<input type="hidden" name = "' + n + '" value="' + /*encodeURIComponent*/(v) + '" />'
				}) + '</form>';
			document.body.appendChild(div);
			var form = div.firstChild;
			form.setAttribute('accept-charset', charset || 'UTF-8');
			try {
				if (document.all) document.charset = charset;
			} catch (e) {

			} finally {
				form.submit();
			}
		}

	},
	/*搜索下拉提示*/
	hint: function (e) {
		var kwd = $(e.target || e.srcElement), ek = e.keyCode;
		if (!kwd.val().length || ek == 10 || ek == 13 || ek == 27) {
			sh('kwh', 0);
			gs_d.u = "";
			return;
		}
		if (ek == 38 || ek == 40) {
			if ($('#kwh').css('display') == 'none') { sh('kwh', 1); return }
			var trs = $('#kwh table tr');
			if (ek == 38) gs_d.i = (gs_d.i == -1) ? trs.length - 1 : gs_d.i - 1;
			else gs_d.i = (gs_d.i + 1) % trs.length;

			trs.each(function (i) {
				if (i == gs_d.i) {
					$(this).css('backgroundColor', '#88c4ff');
					var cel = $(this.cells[0]);
					kwd.val(cel.attr('_h'));
					gs_d.u = cel.attr('_u') ? cel.attr('_h') : "";
				}
				else $(this).css('backgroundColor', '#ECF5FF');
			});
			if (gs_d.i == -1) {
				gs_d.u = "";
				kwd.val(gs_d.kw);
			}
		}
		else {
			gs_d.i = -1;
			gs_d.kw = kwd.val();
			/*如果是搜索音乐*/
			if (this.num == 2) {/*由于添加搜狗，音乐的num+1*/
				dcs('http://suggest.mp3cn.net/song/?call=J1616.www.search.mp3back&type=songname&n=0,10&q=' + euc($.trim(kwd.val())), 'fsg');
			} else {
				dcs('http://so.1616.net/wwwfirst/?q=' + euc($.trim(kwd.val())), 'fsg');
			}
		}
	},
	mp3back: function (d) {
		var k = $.trim($('#keyword').val()), h = '', _s = " onmouseover='this.style.backgroundColor=\"#88C4FF\";gs_d.u=\"\"' onmouseout='this.style.backgroundColor=\"#ECF5FF\"' onclick='shmd(this)'";
		if (!k || k != d[0].split('|')[0]) return;
		for (var i = 1; i < d.length; i++) {
			h += '<tr' + _s + '><td _h="' + d[i][4].replace(/\"/g, '') + ' ' + d[i][7].replace(/\"/g, '') + '"><a><span>' + d[i][7] + '</span> ' + d[i][4] + '</a></td></tr>';
		}
		$('#kwh').html('<table onmousedown="stopBubble(event)" width="100%" cellpadding=0 cellspacing=1>' + h + '</table>');
		sh('kwh', h.length > 0);
	},
	init: function () {
		var T = this, swf = getSWF('clockswf');
		this.swf = swf;
		var timer = setInterval(function () {
			//if (swf.GB2312) {
				clearInterval(timer, timer = null);
				T.events();
				$('#s-tl>a:first').click();
			//}
		}, 100);
	}
};

/*搜素后面的广告链接*/
(function() {
	$.getScript('http://www.1616.net/jd/data/index/indexad.json', function() {
		var s = "";
		for ( var itm in _CBK_1616_indexad) {
			if (_CBK_1616_indexad[itm]['css'] == 2) {
				var css = "class='hot'";
			} else if (_CBK_1616_indexad[itm]['css'] == 3) {
				var css = "class='hot2'";
			} else {
				var css = "";
			}
			s = '<a ' + css + 'href="' + _CBK_1616_indexad[itm]['link'] + '">' + _CBK_1616_indexad[itm]['text'] + '</a>';
			$("#kws").append(s);
		}
	});
})();


/**
* App:股票
*/
J1616.www.stock = {
	W: J1616.www,
	_ifr: $("#ifother")[0].contentWindow,
	__cfg: ["sz000002$sh600036$sh601318$sh601899", "of000011$of377010$of050004$of110002", 0], /*默认的四只股票,默认的四只基金,默认选择的tab索引*/
	__login: function () {
		var T = this;
		try {
			T._ifr.stock_login(T.W.ac, T.W.cfgs["stock"])
		} catch (e) {
		}
	},
	__logout: function () {
		var T = this;
		$("#tishi").show();
		try {
			T._ifr.stock_logout(T.W.cfgs["stock"]);
		} catch (e) {
		}
	}
};

/**
* App:彩票
*/
J1616.www.caipiao = {



};


/**

* 主入口，一系列init()调用。

* init函数内部逻辑是不依赖配置的，只用来在页面上添加静态内容，或给静态内容绑定事件等。

* 依赖配置的逻辑，请写入各App的__login()和__logout()

*/


/*判断url来由,1有用户分享歌曲*/

if (location.search.match(/music[^\=]*=\d+/i)) set_bc(3);


$.each(['search', 'famous', 'index'], function () {

	try {

		J1616.www[this]['init']();

	} catch (e) {

	}

});

